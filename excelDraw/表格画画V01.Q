[General]
SyntaxVersion=2
BeginHotkey=120
BeginHotkeyMod=0
PauseHotkey=19
PauseHotkeyMod=0
StopHotkey=123
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=3ac71e40-6a75-4037-a3c4-143731b51638
Description=表格画画V01
Enable=1
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=1
QUI=FormMain
[Relative]
SetupOCXFile=
[Comment]

[UIPackage]
UEsDBBQAAgAIAJK2Ek255OHzDBQAAAgUAQAJABEAVUlQYWNrYWdlVVQNAAcZo3hbGaN4WxmjeFvtXQmYVNWVPq/Z90VAdtlFQKBZZVGhWTuhG6RbwQ0t2rIp05vV1QLGMSQuMeuYfTfBmcTEJcZEyBgUCS5RDEIMIcZMEpcsTJYJTKJJxij5z6sq+tHQSZ17D326hOv3f7fVevd/9767/efcpQ2lw949vV7c/MDAl6hJOI/a0JuHO1H7yH8rAILsv/RM/3sb4M3Dhw9n//Mm4PCpkDfhDaAtvtlMgL91O6AD0AnoCHQGugFdgK5A9/Snpx5AL6AP0Bs4DegLnA70A/oDA4EBwCBgCDAYGAoMA84AhgOjgBHASGA0cCYwBhgLjAPOAsYDZwMTgInAZGASUAhMA6YAU4HpwDnADGAW8A5gDjAbmBvWaaJzgfOB+cA8oAhYBCwAFgKLgaXAEqAYeDvwNmAZsBwoAUqBFcBK4AKgDLgQKAcuAlYDq4CLgUuBS4DLgDXA5cAVQAy4ElgLxIEK4CrgamAdUAkkgCrgGqA6085qEdcAdUASuBaoBxqAFHAdsBFYD2wArgduAN4J/BvwLuBG4N3ATWEeavFPCt9kEdJNIc2NJAn9UGOydSn4F7+dvL9r5zYz9wXcZ4SFF5Zbcfg9XUNHCoIs/0eb+1EszZvlj/6vBfhqyzzeoHOEv92/4D8SR0I5yrsONaAUNaI6rAmy0JsKQv5emX431+faZmKuU6dw8mJxbbLao/kRP18SS9S4Ph+QX/B93jcs2lARr9pz6Jnndz9swi9o8scNrv1OY/9XcNR8L9dv1jFbfhh1YhgFqxzfoTv6vy6Unqfkyl8Q6f8uwihbD7i+QU+H/LeJ8K8Eawwj/3KUQ5Vw7M32/10zaebK3zbCXw7+DeHMwfn7B9L88zjZJfP3Asw+qoCk45v0ceBvH8l/I38RvkNFOGcU8ofz5R6C8u/Q5PtXeJZ/t0x7ypW/I6Xn8NGQQAV63rozdQgdjPlfO36ZhyVZUjasLFZTP6wsnkxcfYL4R9+zxuv5S9DzJNH/xEM1IQ/c//bNtKlc61+nSP1fhrYnb3VH1/+emfRy5e983PZfhvdYh3KQjYb90f5Z+/YW8HeJ8M/H7L8uHAOSQA3eQTYK9UP+O1Fal+fK3zXCvxh5r/Hrf8TjH/dXc4/kvwqjbyXegcu9xqX/F/N3P+r7x1D+KbwDl0NR+B2yI0Fj3Wg+jEX596NGm1cu/D0i/EVh+un2lwvfcepf0EfI3zPC79t/WIeiZO36+nhR7QbH54urK1fEUuuc+fNdv5Sj5qfCua9L7Qv7H3H76xWpfyvAvwHsVaEVSx66O/D3bsLP868G5NvFCtPfgT9qL0/bnwqdvx/bn1jPsH10YHM/ytidet524uxPkvzzeNkp87eC/gz5x1Du4x/3l9l5o4b+HEZpe3au/H3JVn/2I139OZzS9v5c+U8nff05VsB/dPvT0Z8TBPz9SVd/sl9llIB/QITfN/jan+KZ/mBKkPbdSEMB2Qbr8d9Xf2rYH9h/N0RQ/wZSo/1BQ3+yz3CQgH8QqerP0G85QMA/mHT1Z9ZPmiv/ENLVn+zTHSngH0qq+lM8/+CxOqs/VyDXKVrnw+81/1uMsb8Kb+BR/8X8w6jR/r774SfvvWHcxHFW/aev/hy3ZZ3X84M2l5u+f1FDKlVb4/F8qqYsFUs6N6Ay1L2NzrNftiXJ69/wSPsvDfu+arTCKmf7h5R/RIR/Kfiuc7a+pPu/8SSzv4xs0v9VQH3Wt6D+HhXhLwY798Bu7G72t9EUHf9Y/05xrv/R9RfNreLI6t7Won9Zq7Y/Uv9b3v/K8yVN/yuvt5pOuY//Y8lW/55FuvqX185NFOR/HNn6X8dHvn++2y8fvXvXw9vuc1984atffcf/FyFgefHtmjZEhQ6F6Vv+Fv73CaRr/+DRY7ag/Z1Nuv53tltMFfBPJF39y1qmUMA/iXT9r3MyaebKP5l09S+v650n4C8kXf3La5BnCfinkK3/levqXNIJ1uPHgSZ5vj2TYFAQjGiJ9ReTtvrpz2mP2upXC//bNFLVf2L+6aSr/6T8Myjqf2S/Yz3+iWMUkL/DQIf8zyRV/2eQ3VPh7v+c6tH/BQH7k3gEW9jMb1qb/uP5gqL/U/z9Z1F6DVRY/rU1qViiJp505D/yvKMLO9/1x777djzINlQrfl/9oqH/eX9UsaD9zyZb/T+HdPU/7xErEuR/Lunr/wsE/NxfZ/W/hf47j3T1H+/ZKxXk/3zS1X+8N3CJgH8e6eq/lZTew5gr//xI/nnfwBh0ojOAxxw60zZkG6z5ff3v/MMuxSVLSuYXl5YtXb5Kyu87/mno/+WU3j+ba/0rIl39z/tvVwj4F5Cu/uf9wiUC/oVkq/+5r5gbKX/mj2EMrgk1SHHoja7OUQ8ORf7LSeb/4v66T+ZvC//jErJdf7qUdNd/S/mLSW/9l6/9u7imriHlvnybFiZj68vjG1L1js/nu/7YfMjv+dax/nmaR//X6P9d3cxvWkL/X0W59/+sl7Lzbwv9z3ola3/Q0H/Zcy1y5V9Gqvov4PM04gL+EtLVfxdT+tyPXPlLydb/y/O1giPtz1v/ievfCtLVf3y+ylpB+V9AuvrvSkqf85Ir/0pS1X/i8i+j1rP+O1WQ3g9YASH3U4fntfLhGnz1p7X/S0P/8dlFqwT1v5x09V/2vKRc+S8kXf3HZRsT8F9EtvqPv5Xl/tvVFNVfsdD7tT6jg6ShtwP/xRH+Esx8q8L9v8syClic/4DP9rpG8P0vIdv1r5dG+K31iy9/vq8f9w2+68c1/N8Jktl/LiPb9c+XR/h51EmGzFWZ3f8nvv9bQ03XP093/n6sf3k843P9mqsGrc3/zXrNcv3zldTo/9bQvzxm1lPu/X+MbP2fayP8Rama4urKsnW1693KP9/tZ8/cuXenj//eev1wCgX4X4j3Iv6jw/Ma9g8+e7RKUP8ryNb+wbNMS/93nHTtH3wW7AZB+V9NuvYPPnP2WgF/Jen6v/mM21oB/zrSXf/MraZawJ8gXf3L5/veKOC/JsLfjmxDvvvvfYP1+mEN+we33PWC+vcOsrV/8FjVuP+75f2/1WS7/rmGbNc/15Lt+uc60l3/nD1b3d3/OcOj/jf6P9/TzG/+mf7z3j+QrK1Mxuvri2JJr+chQpyez3f94RsOHjzo9byF/ue5Ypcj/V/L6/9khF9D/9+G+L2C9l9Puv7v95HM/pYiXf833yOxSZD/BrLVfyfi/C8J/3Wkq/9uRvxBQfmvJ139937Etwj4N5Ct/3sj6eq/D1H6PpVc+a8nXf3374g/LOB/Z4T/PAyAjwPJAqJnHQbD9mQb3grrv32Cr/1QQ//divgDgvp3A9nqP56rZ/Uf9z6JjOc7duQcaFH7C/v/jwjyfyPprv+9nWTj/7soOv9g5dnQouf/bjoufxEtaSH9925q6n+b6VH/goD30/wS+EQzv2lt/jfWidn1n6fuQDq54Tt++Pq/1PYfOx4hlu/2g713PfS6j//SQn/fRLr+988h/izlPv7eTLb+91tIV39/HvHHBPm/lfT1950CfraVWPpfbyNd/f0pxF8U5P99pKu/v4D40wL+99Ox9z+5Bt/+/1x0oKOBeujPJxw6U+v7n/Jdf2r43/8D8ScF9e8DpGt/+RLijwv4P0i69pf/RLxZwP8h0l1//hnEdwj4P0y2+pvtVZr7j79MMv3Levm0zN8W+48/Qrb7jz9KR6//7lxcsqR00SqX4wfM57+++mVFoiLVkHS/QKq4urI0vj5/109a7D//GLW2+5fOcS6/qP/9a838Jmv3GXZ/67D/fJwa9ZeF/vsE6eq/+xF/nXIf/z5JtvrvU6Sr/76B+C5B/j9N9vsms8F3/QLvY+b7FO/IlGtL95++wVo/nIz+98+Qrv6/B/G3BO3vs6Sr/x9AfK+A/3Oku/56C+K7BfyfJ1399yDirwr4v0Cq+i/YivjbAv47SFf/3Yf4mwL+L5Kt/vsS2a6/3Uyq/lcx/53Ueua/1uvfK1ckNvg8X1aVuMrZecTlX5uoSZWl4nWOz+e7/yitf2Z5tP8g+AriZ4Ftzfwmq3tai/5he6Xi/lMxP9sLNc9f+i7iHZR7//9l0l1/upNk9revkK7+4ctfHhLk/y7S9389Tbb3z0rK/6vUes7/YTss74ebF6T9AtLQ0bj/zPf7XzX0zyOInxDU/6+Rrv55DPF2Af/dZLv++B7SvX/2KcTfEeT/XtLVP98nWf9/H+nqn0cRPyPI/9fJVv+wvTKrf0qQa58JcEcH/m9E8t8nz/s/6+d9/U8Lnr7V63lf/VMS+l296l/wPcRPCtrfA3S89b9uwcX/+k2Kzv8SYf+7ONTf14Zvwr1QrjPRwcj/bpL1f9+K8CusP6fHEe8SlP+DZLv+ewvZrv/eSk3XfxfSZOf61+j/+0Ezv2lt+pdtlZb6l8+r0dS/P0a8X1D/HyJd/fu8sP1/h3T173OI9wjyvy3CvyQZ27gsUZ1wnQGd7PuvffVvV4DtN3NREC87PN/J8/217B+/oPyxfzxMuv6/H1L67OJc+R8hXf37E8T7BPzbyVb/Pkq6+vfniPcK8r+DdPXvyyTr/79Luvr3R5S+QzpX/p2kZ//zPT/K2v512Pj9xxrzW9g/2F5naf94nKLnP/vr358h/m9B+3uCbPXvk6Srf18R9n/fI139+wLiFwXl/xTZ6t+nyVb/7iK987+t7V/LYmvjVb7PF7o//9bw/xeSaxGw/YP1fEdk5DfN/KYl7B9/ErR/9hVk5y0W65/ZX5K1v2jYP/6A+PeC/O8mXfvH/yJ+VcD/LOnaPw4g/pWAfw/Znj+1N/L9LfTvDyL533Pomee33W/X//jaT3gvK9+nwT49l3lcZ7IN1vtXNewf/4P4kKD9PUe69g8+9/y3Av4fkq39Yx/prn/+P8S/FuT/R6Rr/2DePwv495Ou/eN3iA8K+H9Mtv5/9hdY3r/0k0j+rdf/Ws9/VfRDWTzVUGeTf9/nyzPtrh6tMBbaAGR10GX9+QtHtf8G8NWi90nQ9W7zfzH/T+lY/6/j8UFH+X//1sxvWkL/tAty7//YVmWpf35Guvs/mfRNyj3/Pydd/cONsIOg/H9Buvrn/xH/RZD/F0nP/v/0gf2PPfLSQ6+7Pj979mwv/hcOvur1/C34bv2AawuIJjh0pl3JNvjqBwv9y74qy/OfXiZd/y9X/jaC9v8K6eqfANx/F7T/X5Kt/vkV6eqftsj/XwX5/zXp65/2gu//G9LVP28gLhDwHyA9+7+vfrDev+EbVPTDFPfn89H/y/YiS/37W4raf1te//yObPXP7+lY/TPV8fuz/nmN0nOnLs1Uxqzumbz/xOmf0wX9H/tLLPUP+0s0/T+9kPeegvz/kXT1T29wDxDwHyRd/dMV3J0E/IfI1v/D9lrL+e+fqPXc/73tua1PvbJ3/xYrfl//E98lwPupeE/JTqf6Yxs09E83VKK+gvb3Z9LVP6eBu7uA/1Wy1T+vka7+YftFZ0H+/0L6+qe/gP+vpKt/eoC7j4D/b2Tr/2F7neX89/VI/q39z6f8Twr6car78xb65+9kq3/eoGP1zzTH8ov6f4Y0U5myuudE6p+zBP0f+0os9Q//SFP/jETeRwjyz41eU/+MQnrjBfxBoKt/hiK9QQL+ggj/qTtw/jne6iHf1y/z3Tc7v719q+vzmzz5ffXjUEqfX1sBuNxC1s3z/S3sH+wrs7R/tA10/X9nIL0zBf1vu0BX//L9KcME/OyrstS/HQJd/TsW6Q0W5L9joK9/xwn4OwW6+nc40hsj4O8c6K3/yHf9mO/+R9/7KyzsH+wnsrR/dA1s/X/dAlv92z04Vv9Od/z+0L80MEjfIz3JUP9K8s/2Qsv7L9hX1yXzt4b+nY70pgn6/16R719cXVkSS9Q4X2Bzsp//4nt/Bd//wPN/3pPicgK6b/lZ3H/SW9n+MQPpnS2o/6cFtv5f6/Nv+ijrn0KkN0tQ/n2V9c9MpDdFwN9PV/8Ec5DeZAH/6cr6ZzbSmyjg7684/8/3+y99w01X3H/A5/nimrqGlPPsnYgH7pXxutqkYxPS0L98dtm5gvo3QFn/TkV65wj4Bwa2/t9Bge39J4MD2/tPhgSt7f6/Qprh+P2z/r9y5Gm+of4pEdT/oRH7q4X+OSPQ3f+1BOktFuR/mLL/bynSKxXwD1ee/xYhvfMF/CMUx39r/bZn367tPvvPNnny79ixw+v54sy3mFeQvpdEXv/9goX+Ganr/xH3P6OU9c8CpPd2Qfsbrax/uA4tFPCPMfb/nKmsf5YF6ftjcuUfq+v/oQuQ3goB/1nK89/lSO9tAv5xrcj/4zt+/KFJnm/PJBgUBCNaQv+Rcf59z9+z0D/jjf0/E47SHzHM/+ppfUYHSYOL/+XsIHr+aANKgM+9XBaeRBqX5z9YhPTKBO1/YoS/NMx3dXgKZUvd/z4pwr8UfNc5q890/7cykJ0/OrmJ/q/AN6hvwfM/CyP8POokQ+aqcAYiHYVd6v+UCP+4Leu8+o9Bm8u9ni/w7P807Gflibp6MgrW+ukN1Jn3IL4Z4JNYbwHeS2kbyW2Z+FR464as/WumY/1h/382rVWG9q8Kwfg31dj+NS3Cr2H/uhzpXSbI/3Rl+9capHeVgH+Gsv1rNdK7UMA/09j/e85x9WfL2T9mRfi//9Ku7Zbjj+/66ZswgahFfla3IdrtMJj2INtg7T/VsH9djHKPCdrfbGX71xVI7xIB/xxj+9dcZfvXWqR3kSD/5yrbvyqR3tUC/vOU7V9xpHelgP98Y//vPGP7x/yg9Zz/6hus7WfW+tk3WNi/ipTtX5civYSg/S8wtn8tVLZ/rRPavxYZ278WG9u/lij6PzhI+bWDD/8/AFBLAQIXCxQAAgAIAJK2Ek255OHzDBQAAAgUAQAJAAkAAAAAAAAAAAAAgAAAAABVSVBhY2thZ2VVVAUABxmjeFtQSwUGAAAAAAEAAQBAAAAARBQAAAAA


[Script]
//********************************************************
//在excel表格上面画像素图
//要使用剪贴板的功能，请保存剪贴板的内容
//会在图片的路径下，创建临时文件夹，存储效果图片
//在程序运行过程中，不要随意切换窗口，移动鼠标，按键盘，以免发生误操作
//程序来源于：布尔的布（微信公众号：boolqun）
//********************************************************
Dim imgFilePath//图片文件存储路径
Dim imgFilePathNew	//图片文件存储路径(新的效果图片)
Dim imgDirPath	//图片文件的文件夹
Dim imgMain//图片的主要对象
Dim imgNew//新的图片对象
Dim imgNewPointStep//图片像素化的步长//新的图片对象
Dim imgNewGrayLimit//图片灰度阈值//新的图片对象
Dim imgNewVector//图片的像素向量数组//新的图片对象
Dim imgPixels	//图片的像素点数组
Dim pointHSL//图片的像素点
Dim progressValue//像素处理的进度
Dim progressStep   //像素处理进度的步长
Dim permitDraw//允许开始画图//"goToDraw"为允许画图
Dim fillTexts()//用于填充的文本数组
Dim fillTextsIndex	//数组索引//用于填充的文本数组
Dim showOutText//字符画输出文本
Dim exitNowCount//计数器//当达到一定数量才停止程序//停止当前运行
Dim mouseX,mouseY	//鼠标坐标记录

//事件-------------------------------------------------------------------------------------------------
//加载完成后//事件
Event FormMain.LoadOver  
 	FormMain.ShowReport.Text ="1、先选择图片"& VbCrLf &"2、设置图片效果参数" & VbCrLf & "3、点击刷新图片" & VbCrLf & "查看图片效果"
    FormMain.ShowReport.Text = FormMain.ShowReport.Text & VbCrLf & "4、开始画图" & VbCrLf & "将窗口切换到excel表格"
    FormMain.ShowTips.Text= "将鼠标移到触发区域，可以停止程序运行" & VbCrLf & "(触发区：屏幕左上角或者右上角)"
    Call SlideReportShow()  //显示滑块选择结果//子程序
	EndScript
	permitDraw = ""//允许开始画图//"goToDraw"为允许画图
	exitNowCount = 0//计数器//当达到一定数量才停止程序//停止当前运行
End Event 
//图片效果刷新//事件
Event FormMain.BtnImgShow.Click
	permitDraw = ""//允许开始画图//"goToDraw"为允许画图
	exitNowCount = 0//计数器//当达到一定数量才停止程序//停止当前运行
	imgFilePath = FormMain.ImgPath.Path
    If imgFilePath = "" Then
		Msgbox "图片还未选择，请选择一张图片。。。"
		Exit Event
	End If
	FormMain.ShowReport.Text = "开始生成效果图片。。。"
	
	FormMain.ImgMainShow.Picture = imgFilePath
	Call GetImgPixels()  //获取图片的像素组//子程序
	EndScript
    Call ImgToGray()	//图片灰度化//子程序 
    EndScript
    Call CreateNewImg()	//创建新图片//子程序
    EndScript
	
	If imgNew.Width > 0 and imgNew.Height > 0 Then 
		permitDraw = "goToDraw"//允许开始画图//"goToDraw"为允许画图
		FormMain.ShowReport.Text = "效果图片成功生成"
	Else 
		FormMain.ShowReport.Text = "效果图片异常。。。"
	End If
End Event

//开始画图//事件
Event FormMain.BtnStart.Click	
    If permitDraw <> "goToDraw" Then 	//允许开始画图//"goToDraw"为允许画图
		Msgbox "新的图片的参数不对，请重新选择参数。。。"
		//ExitScript //结束脚本线程的执行，在主线程执行时主脚本停止，其他线程仍然继续运行。
		Exit Event
	End If
	FormMain.ShowReport.Text = "开始画图。。。"
	exitNowCount = 0//计数器//当达到一定数量才停止程序//停止当前运行
	MsgBox "请打开表格窗口，然后关闭这个窗口"& VbCrLf &"在3秒内，选中要开始的单元格"& VbCrLf &"程序倒数3秒后，就自动开始画图。。"
	Call TimeDown(3)	//倒计时//子程序
    EndScript
    Call GetFillTexts()//提取填充的字符//子程序
	EndScript
 	Call ImgDraw()  //画图//子程序 
	EndScript
	FormMain.ShowReport.Text = "画图动作结束"
End Event  

//滑块事件//事件
Event FormMain.PointStep.Slide
	Call SlideReportShow()  //显示滑块选择结果//子程序
	EndScript
End Event
//滑块事件//事件
Event FormMain.GrayLimit.Slide
	Call SlideReportShow()  //显示滑块选择结果//子程序
	EndScript
End Event

//子程序、函数或者过程-------------------------------------------------------------------------------------------------
//画图//子程序 
Sub ImgDraw()
	fillTextsIndex= -1	//数组索引//用于填充的文本数组
	For tRow = 0 To imgNew.Height - 1 Step 1
		showOutText	= "" //字符画输出文本
		For tCol = 0 To imgNew.Width-1 Step 1
			If imgNewVector.Item(tRow * imgNew.Width + tCol + 1) <> - 1  Then //-1为白色；-16777216为黑色
				showOutText = showOutText &	GetFillOne() & vbTab	//GetFillOne()画图填充的单个字符//子程序
			Else 
				showOutText = showOutText & vbTab	//字符画输出文本
			End If
			//TracePrint fillTextsIndex & "   " & fillTextOne & "   " & showOutText
		Next
		//SayString showOutText //字符画输出文本
		Call Plugin.Sys.SetCLB(showOutText)	//设置剪切板内容 
		Call SetCellsText()	//设置表格单元格区域文本//子程序
		EndScript
		KeyPress "Down" , 1   //表格单元格移动//子程序//按键码，按键1次 	
		Delay 100//{延时}里面填写”毫秒”数 
		If ExitNowRun() Then //停止当前运行//子程序
			Exit Sub
		End If
	Next	
End Sub

//提取填充的字符//子程序
Sub GetFillTexts()
	Dim tStrings	//总文本//临时变量
	tStrings = Replace(Trim(FormMain.DrawTexts.Text), Chr(10), "",1) //总文本//临时变量
	tStrings = Replace(tStrings, Chr(13), "",1)
	tStrings = Replace(tStrings, " ", "",1)
	tStrings = Replace(tStrings, " ", "",1)
	If len(tStrings) > 0 Then 
		Redim fillTexts(len(tStrings)-1)//用于填充的文本数组
		For i = 0 To len(tStrings)-1 Step 1
			fillTexts(i) = mid(tStrings, i+1 , 1)//用于填充的文本数组
			//TracePrint fillTexts(i) & "   " & Asc(fillTexts(i))
		Next
	Else 
		Redim fillTexts(0)//用于填充的文本数组
		fillTexts(0) = "~"	//用于填充的文本数组	
	End If
	//TracePrint UBound(fillTexts) & " " & LBound(fillTexts)	
End Sub
 //画图填充的单个字符//子程序
Function GetFillOne()
	fillTextsIndex = fillTextsIndex + 1	//数组索引
	If UBound(fillTexts) < fillTextsIndex Then 
		fillTextsIndex= LBound(fillTexts)	//数组索引
	End If
	GetFillOne = fillTexts(fillTextsIndex)//数组索引//用于填充的文本数组
End Function

//设置表格单元格区域文本//子程序
Sub SetCellsText()
	KeyDown "Ctrl", 1
	Delay 200//{延时}里面填写”毫秒”数
	KeyPress "V", 1
	Delay 200//{延时}里面填写”毫秒”数
	KeyUp "Ctrl", 1
	Delay 200//{延时}里面填写”毫秒”数
End Sub

//创建新图片//子程序
Function CreateNewImg()
	//imgNewPointStep//图片像素化的步长//新的图片对象
	//新的图片对象
	Set imgNew = imgNewVector.ImageFile(Int((imgMain.Width-1)/imgNewPointStep)+1, Int((imgMain.Height-1)/imgNewPointStep)+1 )	
	imgDirPath = Left(imgFilePath, InstrRev(imgFilePath, "\", - 1 , 1)) & "表格画图_临时文件夹" //图片文件的文件夹
	If Not Lib.文件.判断文件夹是否存在(imgDirPath ) Then 
		Call Plugin.File.CreateFolder(imgDirPath )
	End If
	imgFilePathNew = imgDirPath & "\" & Replace(Now, ":", "") & "." & imgNew.FileExtension//图片文件存储路径(新的效果图片)
	//保存图片，显示图片效果
	imgNew.SaveFile imgFilePathNew
	FormMain.ImgNewShow.Picture = imgFilePathNew
End Function

//获取图片的像素组//子程序
Sub GetImgPixels()
	//利用WIA图片处理方法//Windows Image Acquisition
	Set imgMain = CreateObject("WIA.ImageFile")
	imgMain.LoadFile imgFilePath
	Set imgPixels = imgMain.ARGBData
 	//TracePrint imgPixels.Count //TracePrint Hex(imgPixels(i))
End Sub 

//图片灰度化//子程序 
Sub ImgToGray()
	pointHSL  = Array(0, 0, 0)//图片的像素点
	progressStep =CDbl(100 / (((imgMain.Height-1)/imgNewPointStep)+1 ))  //像素处理进度的步长
	FormMain.ProgressImg.Value = 0//进度条
	Set imgNewVector = CreateObject("WIA.Vector")//图片的像素向量数组
	
	For tRow = 0 To imgMain.Height-1 Step imgNewPointStep		//图片像素化的步长//新的图片对象
		For tCol = 0 To imgMain.Width - 1 Step imgNewPointStep//图片像素化的步长//新的图片对象	
			//下面这句是把16进制颜色("0000FF")转换分解到10进制(H：H, S：S, L：L)分量中   
			Call Plugin.Color.ColorToHSL(Hex(imgPixels(imgMain.Width*(tRow) + tCol + 1 ) AND &H00FFFFFF), pointHSL(0), pointHSL(1), pointHSL(2))
			//下面这句是把10进制(R：255, G：0, B：0)分量合并到16进制颜色值变量中  
			//imgVector.Add ( lib.算法.十六进制转十进制( Plugin.Color.GetRGB(pointHSL(2), pointHSL(2), pointHSL(2))) or &hff000000)
			If pointHSL(2) >= (255 - imgNewGrayLimit) Then	 //图片灰度阈值//新的图片对象
				imgNewVector.Add ((&hffffff) or &hff000000)
			Else 
				imgNewVector.Add  ((&h000000) or &hff000000)
			End If
			If ExitNowRun() Then //停止当前运行//子程序
				Exit Sub
			End If
		Next
		progressValue = CDbl(progressValue + progressStep)	//像素处理的进度//
		FormMain.ProgressImg.Value =  progressValue	//像素处理的进度 //进度条
	Next
	FormMain.ProgressImg.Value =  100 //进度条
End Sub

//显示滑块选择结果//子程序
Sub SlideReportShow()
	imgNewPointStep = FormMain.PointStep.Value//图片像素化的步长//新的图片对象
	imgNewGrayLimit = FormMain.GrayLimit.Value//图片灰度阈值//新的图片对象
	FormMain.LabelSetup.Caption = "像素化（缩小）:"& imgNewPointStep & "  灰度阈值：" & imgNewGrayLimit 
End Sub

//倒计时//子程序
Function TimeDown(tNum)
	Dim tTimeCount
	set tTimeCount = CreateObject("SAPI.SpVoice")
	For t = 1 To tNum
		tTimeCount.Speak CStr(t)
		Delay 1000//{延时}里面填写”毫秒”数 
	Next
	tTimeCount.Speak "Go"
End Function

//停止当前运行//子程序
Function ExitNowRun()
	GetCursorPos mouseX, mouseY//鼠标坐标记录
	ExitNowRun=False
	If mouseX < 15 and mouseY < 15 Then 
		exitNowCount = exitNowCount + 1//计数器//当达到一定数量才停止程序//停止当前运行
	ElseIf mouseX > (Plugin.GetSysInfo.GetScreenResolutionX()-15) and mouseY < 15  Then
		exitNowCount = exitNowCount + 1//计数器//当达到一定数量才停止程序//停止当前运行
	Else 
		exitNowCount = 0
		Exit Function
	End If
	If exitNowCount > 2000 Then 
		MsgBox "鼠标进入触发区域，停止程序运行" & VbCrLf & "(触发区域：屏幕左上角或者屏幕右上角)"
		ExitNowRun=True
	End If
End Function
